<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">

<head>

    <meta charset="UTF-8">
    <title>–ü–µ—Ä–µ–≤–æ–∑–∫–∞ –≥—Ä—É–∑–æ–≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #f5f9ff;
            font-family: 'Poppins', sans-serif;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>

<blockquote class="blockquote text-center"><h1>–ü–µ—Ä–µ–≤–æ–∑–∫–∏ –≥—Ä—É–∑–æ–≤</h1></blockquote>

<div class="row justify-content-center  align-items-center text-center">
    <div class="col-md-auto">
        <h4 class="mb-0">–ü–æ–∏—Å–∫ –≥—Ä—É–∑–∞ –ø–æ –ª—é–±–æ–º—É –∫—Ä–∏—Ç–µ—Ä–∏—é:</h4>
    </div>
    <div class="col-md-auto">
        <form th:action="@{/}">
            <input type="text" name="keyword" id="keyword" size="70" th:value="${keyword}" required/>
            <input type="submit" class="btn btn-light btn-sm" value="üîç"/>
            <input type="button" class="btn btn-secondary btn-sm" value="–û—á–∏—Å—Ç–∏—Ç—å" id="btnClear"
                   onclick="clearSearch()"/>
        </form>
    </div>
</div>

<h4>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</h4>
<a th:href="@{'/sorted/asc'}">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –¥–∞—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é)</a> |
<a th:href="@{'/sorted/desc'}">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –¥–∞—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)</a>

<table id="1" class="table table-striped table-hover">
    <thead>
    <tr>
        <th scope="col">ID –≥—Ä—É–∑–∞</th>
        <th scope="col">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞</th>
        <th scope="col">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≥—Ä—É–∑–∞</th>
        <th scope="col">–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏</th>
        <th scope="col">–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</th>
        <th scope="col">–ì–æ—Ä–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è</th>
        <th scope="col">–î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="cargo: ${listCargoes}">
        <th scope="row" class="text-black" th:text="${cargo.id}">ID –≥—Ä—É–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</th>
        <th scope="row" class="text-black" th:text="${cargo.name}">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</th>
        <th scope="row" class="text-black" th:text="${cargo.content}">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≥—Ä—É–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</th>
        <th scope="row" class="text-black" th:text="${cargo.sendingCity}">–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</th>
        <th scope="row" class="text-black" th:text="${cargo.sendingDate}">–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</th>
        <th scope="row" class="text-black" th:text="${cargo.receiptCity}">–ì–æ—Ä–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</th>
        <th scope="row" class="text-black" th:text="${cargo.receiptDate}">–î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</th>
        <td>
            <a th:href="@{'/edit/'+${cargo.id}}"><button type="button" class="btn btn-info">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button></a>
            <a th:href="@{'/delete/'+${cargo.id}}"><button type="button" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button></a>
        </td>
    </tr>
    </tbody>
</table>

<p class="text-black">
    <script type="text/javascript">
        function getRowsColumn() {
            let table = document.getElementById('1')
            let tBody = table.querySelector('tbody')
            const count = tBody.querySelectorAll('tr').length;
            document.write('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –æ –≥—Ä—É–∑–∞—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ: ' + count)
        }
        getRowsColumn();
    </script>
</p>

<p class="text-black">
    <script type="text/javascript">

        function getCargoesPerDay() {
            let table = document.getElementById('1')
            let tBody = table.querySelector('tbody')
            const rows = tBody.querySelectorAll('tr')

            let cargoesByDay = {};

            rows.forEach(row => {
                let date = row.cells[6].innerText;

                if (cargoesByDay[date]) {
                    cargoesByDay[date] += 1;
                } else {
                    cargoesByDay[date] = 1;
                }
            });

            document.write('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–µ–Ω–∏–π –≥—Ä—É–∑–∞ –ø–æ –¥–Ω—è–º: ' + JSON.stringify(cargoesByDay, null, 2))
        }
        getCargoesPerDay();

    </script>
</p>

<blockquote class="blockquote text-center">
    <h4>–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≥—Ä—É–∑–æ–≤ –ø–æ –¥–Ω—è–º</h4>
    <canvas id="registrationChart" style="width: 80%; height: 500px; margin:auto"></canvas>
</blockquote>

<script type="text/javascript">
    function getCargoesData() {
        const table = document.getElementById('1');
        const rows = table.querySelectorAll('tbody tr');

        const registrationDates = {};

        rows.forEach(row => {
            const dateCell = row.cells[6].innerText;

            if (registrationDates[dateCell]) {
                registrationDates[dateCell] += 1;
            } else {
                registrationDates[dateCell] = 1;
            }
        });

        return registrationDates;
    }

    function renderChart() {
        const cargoesData = getCargoesData();
        const dates = Object.keys(cargoesData);
        const counts = Object.values(cargoesData);

        const ctx = document.getElementById('registrationChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: dates,
                datasets: [{
                    label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π',
                    data: counts,
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    document.addEventListener('DOMContentLoaded', renderChart);
</script>

<blockquote class="blockquote text-center">
    <a href="/new">
        <button type="button" class="btn btn-primary" data-togge="button" aria-pressed="false" autocomplete="off">
            –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
        </button>
    </a>
</blockquote>

<script type="text/javascript">
    function clearSearch() {
        window.location = "[[@{/}]]";
    }
</script>

</body>
</html>